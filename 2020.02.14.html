<!DOCTYPE html>
<head>

    <title>致我最爱的菲菲宝宝</title>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
    <style type="text/css">
        @font-face {
            font-family: digit;
            src: url("fonts/digital-7_mono.ttf") format("truetype");
        }

        @font-face {
            font-family: xinshu;
            src: url("fonts/font.ttf");
        }
    </style>
    <link href="./css/loading.min.css" rel="stylesheet" type="text/css">
    <link href="css/default.min.css" rel="stylesheet" type="text/css">
    <link href="css/letter.min.css" rel="stylesheet">
    <script src="js/jquery.min.js" type="text/javascript"></script>
    <script src="js/word.min.js" type="text/javascript"></script>
    <script src="js/jquery.mousewheel.min.js"></script>
    <script src="js/humanize-duration.js"></script>
<body>
<p style='display: none; font-family: "digit", "xinshu", "Consolas", "Monaco", "Bitstream Vera Sans Mono", "Courier New", "sans-serif" '>
    1234567890周月天小时分钟秒</p>
<div style="position: relative; width: 100vw; height: 100vh;">
    <div id="loading" style="z-index: 9">
        <ul>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
        </ul>
    </div>

    <div class=" content bg-grid" id="content" style="border: 0px greenyellow solid; z-index: 2">
        <p class="code bg-grid">&emsp;&emsp;当宝宝看这封信的时候，和宝宝在一起已经<span id="time"></span>了哦，原本打算和宝宝一起过我们恋爱以后的第一个情人节的，却因为这一场疫情导致计划取消。我只好准备了这个礼物送给宝宝，也不知道宝宝会不会喜欢呀。
        </p>
        <p class="code bg-grid">&emsp;&emsp;这个礼物花了我快一个星期才做好的，可以反映出我对宝宝的喜爱之情了嘛。宝宝经常低估我对宝宝的喜爱，这可是很让我伤心的哦。宝宝以前问过我，如果宝宝和以前我喜欢的女生同时出现的话，我会选择谁，当时我觉得这个说法有点滑稽，毕竟这是不可能出现的事情，后来想想，还是我没能给宝宝足够的安全感。宝宝你一直想让我写封情书，还记得刚开始恋爱的时候，我还偷偷买了信纸，准备写封信寄给宝宝，制造一个惊喜。可是一波三折，没想到最后却是以这样的方式写了信。宝宝你会不会觉得惊喜呀。</p>
        <p class="code bg-grid">&emsp;&emsp;情书的话，该写啥呢，写些风花雪月的话总有些别扭。那就说说我为啥喜欢宝宝吧。宝宝人美声甜，很难不招人喜欢呀，但我表白的时候可连可宝宝长啥样子都不清楚，也难怪宝宝会认为我之所以想让宝宝当我女朋友是因为宝宝没有拒绝我。但我给宝宝的回答是因为喜欢宝宝傻乎乎的样子，不知道宝宝会不会认为我在敷衍宝宝呀。可这却是是我的心里话哟，还记得宝宝刚开始的时候心善被人骗，真的傻乎乎的呢，那时候我就在想，这个世界上怎么会有这么纯真的人呀。后来和宝宝接触以后，更是觉得，这么傻乎乎的宝宝一定得要幸运点才行呀。</p>
        <p class="code bg-grid">&emsp;&emsp;所以呀，宝宝吸引我的地方才不是样貌，更不是因为宝宝没拒绝呢，而是因为宝宝可是天下最好的宝宝呢。好想现在就能见到宝宝呀！</p>

    </div>
    <div id="words">
        <div id="messages">
            我最爱的菲菲宝宝, 我们已经一起走过了
            <div id="elapseClock"></div>
            <div id="loveu">爱你，我们会一直一直走下去的<br/>
                <div class="signature">-- 宝宝最爱的乾哥哥</div>
            </div>
        </div>

    </div>
    <div class="image" id="mailbox">
        <div class="animated-mail">
            <div class="back-fold"></div>
            <div class="letter">
                <div class="bg-grid" id="letter" style="padding-top: 1vh">
                    <p class="preview">
                        我最爱的菲菲宝宝:
                    </p>
                    <p class="preview">
                        xxxxxxxxxx
                    </p>
                    <p class="preview">
                        xxxxxxxxxx
                    </p>
                    <p class="preview">
                        xxxxxxxxxx
                    </p>
                    <p class="preview">
                        xxxxxxxxxx
                    </p>
                    <p class="preview">
                        xxxxxxxxxx
                    </p>
                    <p class="preview">
                        xxxxxxxxxx
                    </p>
                    <p class="preview">
                        xxxxxxxxxx
                    </p>
                    <p class="preview">
                        xxxxxxxxxx
                    </p>
                    <p class="preview">
                        xxxxxxxxxx
                    </p>
                    <p class="preview">
                        xxxxxxxxxx
                    </p>
                    <p class="preview">
                        xxxxxxxxxx
                    </p>
                    <p class="preview">
                        xxxxxxxxxx
                    </p>
                </div>
            </div>
            <div class="top-fold"></div>
            <div class="body"></div>
            <div class="left-fold"></div>
        </div>
        <div class="shadow"></div>
    </div>
    <!--    <div id="loveHeart" style="border: 0px red solid">-->
    <!--        <canvas id="garden"></canvas>-->

    <!--    </div>-->
</div>
<script type="text/javascript">
    let writer = function () {
        let df = $.Deferred();
        $("#content").typewriter().done(function () {
            df.resolve();
        });
        return df;
    };
    together = new Date("2019-07-12 22:08").getTime(); //, "YYYY-MM-DD-HH-mm");
    let loverHeart = function () {
        offsetX = $("#loveHeart").width() / 2;
        offsetY = $("#loveHeart").height() / 2 - 55;
        timeElapse(together);
        if (!document.createElement('canvas').getContext) {
            var msg = document.createElement("div");
            msg.id = "errorMsg";
            msg.innerHTML = "提醒您：您的浏览器版本过旧^_^<br/>";
            document.body.appendChild(msg);
            $("#code").css("display", "none");
            document.execCommand("stop");
        } else {
            setInterval(function () {
                $("#elapseClock").html(timeElapse(together));
            }, 500);
        }

    };

    function timeElapse(c, z) {
        let now = new Date().getTime();
        let units;
        if (typeof z == 'undefined') units = ['y', 'mo', 'd', 'h', 'm', 's'];
        else units = z;
        let dur = "<span class='digit'>" + humanizeDuration(now - together, {
            delimiter: "</span><span class='digit'>",
            units: units,
            round: true,
            language: 'zh_CN'
        }) + "</span>";
        console.log(dur);
        return dur;
    }

    $(function () {
        $(".image").css('opacity', 0);
        $("#content").fadeOut("fast");
        $("#loveHeart").fadeOut("fast");
        $("#words").fadeOut("fast");
        var audio = new Audio;
        audio.autoplay = false;
        audio.loop = true;
        $('body').on("mousewheel", function (event, delta) {
            if (event.deltaY > 0) {
                if (audio.volume < 0.89) audio.volume = parseFloat((audio.volume + 0.1).toFixed(1));
            } else {
                if (audio.volume > 0.11) audio.volume = parseFloat((audio.volume - 0.1).toFixed(1));
            }

        });
        $("body").on()

        setTimeout(function () {
            let ajax = new XMLHttpRequest();
            ajax.open("get", "how_long_will_i_love_you.mp3")
            ajax.responseType = "blob";
            ajax.send();
            ajax.onprogress = function (event) {
                // console.log(event);
            }
            ajax.onreadystatechange = function () {
                console.log(ajax.readyState);
                if (ajax.readyState == 4 && ajax.status == 200) {
                    audio.src = URL.createObjectURL(ajax.response);
                    audio.volume = 0.4;
                    $("#loading").fadeOut();
                    setInterval(function () {
                        $("#time").html(timeElapse(together, ['d']));
                        console.log("vol: ", audio.volume);
                    }, 1000);
                    setTimeout(function () {
                        $("#loading").remove();
                        $("#mailbox").animate({opacity: 1}, 2000, function () {
                            $(".image").on("click", function () {
                                audio.play();
                                $(".letter").animate({top: -150});
                                $(".image").animate({opacity: 0}, 1000, function () {
                                    setTimeout(function () {
                                        $(".image").remove();
                                        $("#content").fadeIn("slow");
                                        $("#content").slideDown();
                                    }, 1000);
                                    $("#content").animate({top: '0vh', height: '100vh'}, 1000, function () {
                                        writer().done(function () {
                                            $("#content").css("cursor", "pointer");
                                            $("#elapseClock").fadeOut("fast");
                                            $("#loveu").fadeOut("fast");
                                            $("#content").on("click", function () {
                                                $("#content").animate(
                                                    {opacity: 0},
                                                    1500,
                                                    function () {
                                                        $("#content").remove();
                                                        $("#loveHeart").fadeIn();
                                                        loverHeart();
                                                        $("#words").fadeIn();
                                                        $("#messages").fadeIn("fast", function () {
                                                            setTimeout(function () {
                                                                $("#elapseClock").fadeIn(2000, function () {
                                                                    $("#loveu").fadeIn(2000);
                                                                });
                                                            }, 2000);

                                                        });

                                                    }
                                                );
                                            });

                                        });
                                    });
                                });
                            });
                        });
                    }, 3000);
                }
            }
        }, 1000);
    });

</script>
</body>
</html>